{"version":3,"sources":["../src/datasource.js"],"names":["GenericDatasource","instanceSettings","$q","backendSrv","templateSrv","type","url","name","q","withCredentials","headers","basicAuth","length","options","lodashLocal","require","query","buildQueryParameters","targets","filter","t","hide","when","data","getAdhocFilters","adhocFilters","console","log","JSON","stringify","doRequest","method","then","queryResult","undefined","tasks","stringToBeSearched","target","lowerCase","columns","rows","snum","i","task","toBeUsed","startsWith","id","dbNames","dbs","dbrps","j","size","db","rp","createdDate","Date","created","substring","modifiedDate","modified","lastEnabledDate","row","push","parseInt","String","toDateString","status","tableElement","tableElements","response","message","title","replace","annotation","annotationQuery","range","datasource","enable","iconColor","rangeRaw","annotationResult","today","date","getFullYear","getMonth","getDate","time","getHours","getMinutes","getSeconds","dateTime","annotationElement","interpolated","mapToTextValue","result","verticalNames","words","split","firstWord","uniq","map","d","text","value","datasourceRequest","_","scopedVars","refId","tagKeys","allTasks","tagValues","key","keyToBeSearched"],"mappings":"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","file":"datasource.js","sourcesContent":["import _ from \"lodash\";\n\nexport class GenericDatasource {\n\n    constructor(instanceSettings, $q, backendSrv, templateSrv) {\n        this.type = instanceSettings.type;\n        this.url = instanceSettings.url + \" \";\n        this.name = instanceSettings.name;\n        this.q = $q;\n        this.backendSrv = backendSrv;\n        this.templateSrv = templateSrv;\n        this.withCredentials = instanceSettings.withCredentials;\n        this.headers = {'Content-Type': 'application/json'};\n        if (typeof instanceSettings.basicAuth === 'string' && instanceSettings.basicAuth.length > 0) {\n            this.headers['Authorization'] = instanceSettings.basicAuth;\n        }\n        // this.lodashLocal = require(\"lodash\");\n    }\n\n    query(options) {\n        var lodashLocal = require(\"lodash\");\n        var query = this.buildQueryParameters(options);\n        query.targets = query.targets.filter(t => !t.hide);\n\n        if (query.targets.length <= 0) {\n            return this.q.when({data: []});\n        }\n\n        if (this.templateSrv.getAdhocFilters) {\n            query.adhocFilters = this.templateSrv.getAdhocFilters(this.name);\n        } else {\n            query.adhocFilters = [];\n        }\n\n        console.log(\"query api called\");\n        console.log(\"The query data: \" + JSON.stringify(query));\n\n        return this.doRequest({\n            url: this.url,\n            method: 'GET'\n        }).then(function (queryResult) {\n\n            console.log(JSON.stringify(queryResult));\n\n            if (queryResult == undefined || queryResult.data == undefined || queryResult.data.tasks == undefined) {\n                return {data: []};\n            }\n\n            var stringToBeSearched = \"\"\n            if (query != undefined && query.targets != undefined && query.targets[0] != undefined && query.targets[0].target != undefined) {\n                stringToBeSearched = lodashLocal.lowerCase(query.targets[0].target);\n            }\n\n\n            var tasks = queryResult.data.tasks;\n\n            console.log(\"The task data: \" + JSON.stringify(tasks));\n\n            var columns = [\n                {\"text\": \"S.No\", \"type\": \"string\"},\n                {\"text\": \"created\", \"type\": \"time\"},\n                // {\"text\": \"dbrps\", \"type\": \"string\"},\n                {\"text\": \"id\", \"type\": \"string\"},\n                {\"text\": \"last-enabled\", \"type\": \"time\"},\n                {\"text\": \"modified\", \"type\": \"time\"},\n                {\"text\": \"status\", \"type\": \"string\"},\n                {\"text\": \"type\", \"type\": \"string\"}\n                // {\"text\": \"script\", \"type\": \"string\"},\n            ];\n\n            var rows = [];\n\n            var snum = 1;\n            for (var i = 0; i < tasks.length; i++) {\n                var task = tasks[i];\n\n                var toBeUsed = false;\n                if (lodashLocal.startsWith(lodashLocal.lowerCase(task.id), stringToBeSearched)) {\n                    toBeUsed = true;\n                }\n\n                var dbNames = \"\";\n\n                if (!toBeUsed) {\n                    var dbs = task.dbrps;\n\n                    for (var j = 0; j < lodashLocal.size(dbs); j++) {\n                        if (lodashLocal.startsWith(lodashLocal.lowerCase(dbs[j].db), stringToBeSearched)) {\n                            toBeUsed = true;\n                        }\n\n                        dbNames += dbs[j].db + \".\" + dbs[j].rp + \", \";\n                    }\n                }\n\n                if (toBeUsed) {\n\n                    var createdDate = new Date((task.created).substring(0,19));\n                    var modifiedDate = new Date((task.modified).substring(0,19));\n                    var lastEnabledDate = new Date((task[\"last-enabled\"]).substring(0,19));\n\n                    console.log(\"Created Date: \" + createdDate);\n                    var row = []\n                    row.push(parseInt(String(snum)));\n                    // row.push(createdDate.getFullYear()+\"/\"+(createdDate.getMonth()+1)+\"/\"+createdDate.getDay()+\" \"+createdDate.getDate());\n                    row.push(createdDate.toDateString());\n                    // row.push(dbNames);\n\n                    // var htmlId = \"<html><head></head><body><iframe src=\\\"http://prod.chronograf.paytm.com/sources/1/tickscript/\"+task.id+\"\\\"  style=\\\"height:80%;width:50%\\\"></iframe><p>Alert ID</p></body></html>\";\n                    // var htmlId = \"<html><head></head><body><embed src=\\\"http://example.com/elements.html\\\"></embed><p>Alert ID</p></body></html>\"\n                    // var htmlId = \"<html><head></head><body><form action=\\\"\\\"><label for=\\\"fname\\\">First name:</label><br/><input type=\\\"text\\\" id=\\\"fname\\\" name=\\\"firstname\\\"><br/>Last name:<br/><input type=\\\"text\\\" name=\\\"lastname\\\"><br/><br/><input type=\\\"submit\\\" value=\\\"Submit\\\"></form></body></html>\"\n                    \n                    row.push(task.id);\n                    row.push(lastEnabledDate.toDateString());\n                    row.push(modifiedDate.toDateString())\n                    row.push(task.status);\n                    row.push(task.type);\n                    // row.push(task.script);\n                    rows.push(row);\n\n                    snum++;\n                }\n            }\n\n            var tableElement = {};\n\n            tableElement[\"columns\"] = columns;\n            tableElement[\"rows\"] = rows;\n            tableElement[\"type\"] = \"table\";\n\n            var tableElements = [];\n            tableElements.push(tableElement);\n\n            console.log(tableElements)\n            return {data: tableElements};\n        });\n    }\n\n    testDatasource() {\n        return this.doRequest({\n            url: this.url,\n            method: 'GET'\n        }).then(function (response) {\n            if (response.status === 200) {\n                return {status: \"success\", message: \"Kapacitor is reachable\", title: \"Success\"};\n            }\n        });\n    }\n\n    annotationQuery(options) {\n        var query = this.templateSrv.replace(options.annotation.query, {}, 'glob');\n        var annotationQuery = {\n            range: options.range,\n            annotation: {\n                name: options.annotation.name,\n                datasource: options.annotation.datasource,\n                enable: options.annotation.enable,\n                iconColor: options.annotation.iconColor,\n                query: query\n            },\n            rangeRaw: options.rangeRaw\n        };\n\n        var annotationResult = [];\n\n        var today = new Date();\n        var date = today.getFullYear() + '-' + (today.getMonth() + 1) + '-' + today.getDate();\n        var time = today.getHours() + \":\" + today.getMinutes() + \":\" + today.getSeconds();\n        var dateTime = date + ' ' + time;\n\n        var annotationElement = {\n            \"annotation\": \"Paytm Alert Manager\",\n            \"time\": dateTime,\n            \"title\": \"Vertical Alerts List\"\n        };\n\n        annotationResult.push(annotationElement);\n        return annotationResult;\n\n    }\n\n    metricFindQuery(query) {\n        var interpolated = {\n            target: this.templateSrv.replace(query, null, 'regex')\n        };\n\n        return this.doRequest({\n            url: this.url,\n            method: 'GET'\n        }).then(this.mapToTextValue);\n    }\n\n    mapToTextValue(result) {\n        var lodashLocal = require(\"lodash\");\n        console.log(result)\n\n        if (result == undefined || result.data == undefined || result.data.tasks == undefined) {\n            return {data: {}}\n        }\n\n        var tasks = result.data.tasks;\n        var verticalNames = [];\n\n        for (var i = 0; i < lodashLocal.size(tasks); i++) {\n            var task = tasks[i];\n            var words = task.id.split(\"_\");\n            var firstWord = lodashLocal.lowerCase(words[0]);\n\n            if (lodashLocal.startsWith(firstWord, \"chronograf\")) {\n                var dbs = task.dbrps;\n\n                if (dbs != undefined && lodashLocal.size(dbs) > 0) {\n\n                    for (var j = 0; j < lodashLocal.size(dbs); j++) {\n                        verticalNames.push(lodashLocal.lowerCase(dbs[j].db));\n                    }\n                }\n\n            } else {\n                verticalNames.push(lodashLocal.lowerCase(words[0]));\n            }\n        }\n\n        verticalNames = lodashLocal.uniq(verticalNames);\n\n        return lodashLocal.map(verticalNames, function (d, i) {\n            return {text: d, value: d};\n        });\n\n    }\n\n    doRequest(options) {\n        options.withCredentials = this.withCredentials;\n        options.headers = this.headers;\n\n        return this.backendSrv.datasourceRequest(options);\n    }\n\n    buildQueryParameters(options) {\n        options.targets = _.filter(options.targets, target => {\n            return target.target !== 'select metric';\n        });\n\n        var targets = _.map(options.targets, target => {\n            return {\n                target: this.templateSrv.replace(target.target, options.scopedVars, 'regex'),\n                refId: target.refId,\n                hide: target.hide,\n                type: target.type || 'timeserie'\n            };\n        });\n\n        options.targets = targets;\n\n        return options;\n    }\n\n    getTagKeys(options) {\n        var tagKeys = [\n            {\"text\": \"created\", \"type\": \"time\"},\n            // {\"text\": \"dbrps\", \"type\": \"string\"},\n            {\"text\": \"id\", \"type\": \"string\"},\n            {\"text\": \"last-enabled\", \"type\": \"time\"},\n            {\"text\": \"modified\", \"type\": \"time\"},\n            {\"text\": \"status\", \"type\": \"string\"},\n            {\"text\": \"type\", \"type\": \"string\"}\n            // {\"text\": \"script\", \"type\": \"string\"},\n        ];\n\n        return tagKeys;\n\n    }\n\n    getTagValues(options) {\n        var lodashLocal = require(\"lodash\");\n        var allTasks = this.doRequest({\n            url: this.url,\n            method: 'GET',\n        });\n\n        var tagValues = [];\n\n        if (allTasks == undefined || allTasks.data == undefined || allTasks.data.tasks == undefined || options == undefined || options.key == undefined) {\n            return tagValues;\n        }\n\n        var keyToBeSearched = options.key;\n\n        var tasks = result.data.tasks;\n\n        for (var i = 0; i < lodashLocal.size(tasks); i++) {\n            var task = tasks[i];\n            var value = task[keyToBeSearched];\n            tagValues.push(value);\n        }\n\n        return tagValues;\n    }\n\n}\n"]}