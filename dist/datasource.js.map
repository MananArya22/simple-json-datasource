{"version":3,"sources":["../src/datasource.js"],"names":["GenericDatasource","instanceSettings","$q","backendSrv","templateSrv","type","url","name","q","withCredentials","headers","basicAuth","length","lodashLocal","require","options","query","buildQueryParameters","targets","filter","t","hide","when","data","getAdhocFilters","adhocFilters","console","log","JSON","stringify","doRequest","method","then","queryResult","undefined","tasks","stringToBeSearched","target","lowerCase","columns","rows","snum","i","task","toBeUsed","startsWith","id","dbNames","dbs","dbrps","j","size","db","rp","row","push","created","modified","status","script","tableElement","tableElements","response","message","title","replace","annotation","annotationQuery","range","datasource","enable","iconColor","rangeRaw","annotationResult","today","Date","date","getFullYear","getMonth","getDate","time","getHours","getMinutes","getSeconds","dateTime","annotationElement","interpolated","mapToTextValue","result","verticalNames","words","split","firstWord","uniq","map","d","text","value","datasourceRequest","_","scopedVars","refId","tagKeys","allTasks","tagValues","key","keyToBeSearched"],"mappings":"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","file":"datasource.js","sourcesContent":["import _ from \"lodash\";\n\nexport class GenericDatasource {\n\n    constructor(instanceSettings, $q, backendSrv, templateSrv) {\n        this.type = instanceSettings.type;\n        this.url = instanceSettings.url + \"/kapacitor/v1/tasks\";\n        this.name = instanceSettings.name;\n        this.q = $q;\n        this.backendSrv = backendSrv;\n        this.templateSrv = templateSrv;\n        this.withCredentials = instanceSettings.withCredentials;\n        this.headers = {'Content-Type': 'application/json'};\n        if (typeof instanceSettings.basicAuth === 'string' && instanceSettings.basicAuth.length > 0) {\n            this.headers['Authorization'] = instanceSettings.basicAuth;\n        }\n        this.lodashLocal = require(\"lodash\");\n    }\n\n    query(options) {\n        var lodashLocal = require(\"lodash\");\n        var query = this.buildQueryParameters(options);\n        query.targets = query.targets.filter(t => !t.hide);\n\n        if (query.targets.length <= 0) {\n            return this.q.when({data: []});\n        }\n\n        if (this.templateSrv.getAdhocFilters) {\n            query.adhocFilters = this.templateSrv.getAdhocFilters(this.name);\n        } else {\n            query.adhocFilters = [];\n        }\n\n        console.log(\"query api called\");\n        console.log(\"The query data: \" + JSON.stringify(query));\n\n        return this.doRequest({\n            url: this.url,\n            method: 'GET'\n        }).then(function (queryResult) {\n\n            console.log(JSON.stringify(queryResult));\n\n            if (queryResult == undefined || queryResult.data == undefined || queryResult.data.tasks == undefined) {\n                return {data: []};\n            }\n\n            var stringToBeSearched = \"\"\n            if (query != undefined && query.targets != undefined && query.targets[0] != undefined && query.targets[0].target != undefined) {\n                stringToBeSearched = lodashLocal.lowerCase(query.targets[0].target);\n            }\n\n\n            var tasks = queryResult.data.tasks;\n\n            console.log(\"The task data: \" + JSON.stringify(tasks));\n\n            var columns = [\n                {\"text\": \"S.No\", \"type\": \"number\"},\n                {\"text\": \"created\", \"type\": \"time\"},\n                {\"text\": \"dbrps\", \"type\": \"string\"},\n                {\"text\": \"id\", \"type\": \"string\"},\n                {\"text\": \"last-enabled\", \"type\": \"time\"},\n                {\"text\": \"modified\", \"type\": \"time\"},\n                {\"text\": \"status\", \"type\": \"string\"},\n                {\"text\": \"type\", \"type\": \"string\"},\n                {\"text\": \"script\", \"type\": \"string\"},\n            ];\n\n            var rows = [];\n\n            var snum = 1;\n            for (var i = 0; i < tasks.length; i++) {\n                var task = tasks[i];\n\n                var toBeUsed = false;\n                if (lodashLocal.startsWith(lodashLocal.lowerCase(task.id), stringToBeSearched)) {\n                    toBeUsed = true;\n                }\n\n                var dbNames = \"\";\n\n                if (!toBeUsed) {\n                    var dbs = task.dbrps;\n\n                    for (var j = 0; j < lodashLocal.size(dbs); j++) {\n                        if (lodashLocal.startsWith(lodashLocal.lowerCase(dbs[j].db), stringToBeSearched)) {\n                            toBeUsed = true;\n                        }\n\n                        dbNames += dbs[j].db + \".\" + dbs[j].rp + \", \";\n                    }\n                }\n\n                if (toBeUsed) {\n                    var row = []\n                    row.push(snum);\n                    row.push(task.created);\n                    row.push(dbNames);\n                    row.push(task.id);\n                    row.push(task[\"last-enabled\"]);\n                    row.push(task.modified);\n                    row.push(task.status);\n                    row.push(task.type);\n                    row.push(task.script);\n                    rows.push(row);\n\n                    snum++;\n                }\n            }\n\n            var tableElement = {};\n\n            tableElement[\"columns\"] = columns;\n            tableElement[\"rows\"] = rows;\n            tableElement[\"type\"] = \"table\";\n\n            var tableElements = [];\n            tableElements.push(tableElement);\n\n            console.log(tableElements)\n            return {data: tableElements};\n        });\n    }\n\n    testDatasource() {\n        return this.doRequest({\n            url: this.url,\n            method: 'GET'\n        }).then(function (response) {\n            if (response.status === 200) {\n                return {status: \"success\", message: \"Kapacitor is reachable\", title: \"Success\"};\n            }\n        });\n    }\n\n    annotationQuery(options) {\n        var query = this.templateSrv.replace(options.annotation.query, {}, 'glob');\n        var annotationQuery = {\n            range: options.range,\n            annotation: {\n                name: options.annotation.name,\n                datasource: options.annotation.datasource,\n                enable: options.annotation.enable,\n                iconColor: options.annotation.iconColor,\n                query: query\n            },\n            rangeRaw: options.rangeRaw\n        };\n\n        var annotationResult = [];\n\n        var today = new Date();\n        var date = today.getFullYear() + '-' + (today.getMonth() + 1) + '-' + today.getDate();\n        var time = today.getHours() + \":\" + today.getMinutes() + \":\" + today.getSeconds();\n        var dateTime = date + ' ' + time;\n\n        var annotationElement = {\n            \"annotation\": \"Paytm Alert Manager\",\n            \"time\": dateTime,\n            \"title\": \"Vertical Alerts List\"\n        };\n\n        annotationResult.push(annotationElement);\n        return annotationResult;\n\n    }\n\n    metricFindQuery(query) {\n        var interpolated = {\n            target: this.templateSrv.replace(query, null, 'regex')\n        };\n\n        return this.doRequest({\n            url: this.url,\n            method: 'GET'\n        }).then(this.mapToTextValue);\n    }\n\n    mapToTextValue(result) {\n        var lodashLocal = require(\"lodash\");\n        console.log(result)\n\n        if (result == undefined || result.data == undefined || result.data.tasks == undefined) {\n            return {data: {}}\n        }\n\n        var tasks = result.data.tasks;\n        var verticalNames = [];\n\n        for (var i = 0; i < lodashLocal.size(tasks); i++) {\n            var task = tasks[i];\n            var words = task.id.split(\"_\");\n            var firstWord = lodashLocal.lowerCase(words[0]);\n\n            if (lodashLocal.startsWith(firstWord, \"chronograf\")) {\n                var dbs = task.dbrps;\n\n                if (dbs != undefined && lodashLocal.size(dbs) > 0) {\n\n                    for (var j = 0; j < lodashLocal.size(dbs); j++) {\n                        verticalNames.push(lodashLocal.lowerCase(dbs[j].db));\n                    }\n                }\n\n            } else {\n                verticalNames.push(lodashLocal.lowerCase(words[0]));\n            }\n        }\n\n        verticalNames = lodashLocal.uniq(verticalNames);\n\n        return lodashLocal.map(verticalNames, function (d, i) {\n            return {text: d, value: d};\n        });\n\n    }\n\n    doRequest(options) {\n        options.withCredentials = this.withCredentials;\n        options.headers = this.headers;\n\n        return this.backendSrv.datasourceRequest(options);\n    }\n\n    buildQueryParameters(options) {\n        options.targets = _.filter(options.targets, target => {\n            return target.target !== 'select metric';\n        });\n\n        var targets = _.map(options.targets, target => {\n            return {\n                target: this.templateSrv.replace(target.target, options.scopedVars, 'regex'),\n                refId: target.refId,\n                hide: target.hide,\n                type: target.type || 'timeserie'\n            };\n        });\n\n        options.targets = targets;\n\n        return options;\n    }\n\n    getTagKeys(options) {\n        var tagKeys = [\n            {\"text\": \"created\", \"type\": \"time\"},\n            {\"text\": \"dbrps\", \"type\": \"string\"},\n            {\"text\": \"id\", \"type\": \"string\"},\n            {\"text\": \"last-enabled\", \"type\": \"time\"},\n            {\"text\": \"modified\", \"type\": \"time\"},\n            {\"text\": \"status\", \"type\": \"string\"},\n            {\"text\": \"type\", \"type\": \"string\"},\n            {\"text\": \"script\", \"type\": \"string\"},\n        ];\n\n        return tagKeys;\n\n    }\n\n    getTagValues(options) {\n        var lodashLocal = require(\"lodash\");\n        var allTasks = this.doRequest({\n            url: this.url,\n            method: 'GET',\n        });\n\n        var tagValues = [];\n\n        if (allTasks == undefined || allTasks.data == undefined || allTasks.data.tasks == undefined || options == undefined || options.key == undefined) {\n            return tagValues;\n        }\n\n        var keyToBeSearched = options.key;\n\n        var tasks = result.data.tasks;\n\n        for (var i = 0; i < lodashLocal.size(tasks); i++) {\n            var task = tasks[i];\n            var value = task[keyToBeSearched];\n            tagValues.push(value);\n        }\n\n        return tagValues;\n    }\n\n}\n"]}